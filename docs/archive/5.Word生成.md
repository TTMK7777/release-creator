' =============================================================================
' Wordプレスリリース生成
' Microsoft Word XX.0 Object Libraryへの参照設定が必要
' =============================================================================

Sub Word生成(テンプレートPath As String, 出力フォルダPath As String, リリース表Path As String)
    
    Dim wdApp As Object ' Word.Application
    Dim wdDoc As Object ' Word.Document
    Dim リリースwb As Workbook
    
    ' Wordアプリケーション起動
    Set wdApp = CreateObject("Word.Application")
    wdApp.Visible = False
    
    ' テンプレート読込
    Set wdDoc = wdApp.Documents.Open(テンプレートPath)
    
    ' リリース表からデータ取得
    Set リリースwb = Workbooks.Open(リリース表Path, ReadOnly:=True)
    Dim ws As Worksheet
    Set ws = リリースwb.Worksheets("総合3つ")
    
    ' ---------------------------------------
    ' 1. 日付更新
    ' ---------------------------------------
    wdDoc.Content.Find.Execute _
        FindText:="2024年", _
        ReplaceWith:="2025年", _
        Replace:=2 ' wdReplaceAll
    
    ' ---------------------------------------
    ' 2. タイトル生成
    ' ---------------------------------------
    Dim 一位企業 As String
    Dim タイトル As String
    
    一位企業 = ws.Cells(9, 3).Value ' 1位の企業名
    タイトル = "【" & 一位企業 & "】が3年連続総合1位に"
    
    ' Wordのブックマーク・プレースホルダーに挿入
    ' (実際のテンプレート構造に合わせて実装)
    wdDoc.Bookmarks("タイトル").Range.Text = タイトル
    
    ' ---------------------------------------
    ' 3. 本文生成(ルールベース)
    ' ---------------------------------------
    Dim 本文 As String
    本文 = 本文自動生成(ws)
    
    wdDoc.Bookmarks("本文").Range.Text = 本文
    
    ' ---------------------------------------
    ' 4. 画像差し替え
    ' ---------------------------------------
    Call Word画像差し替え(wdDoc, "総合ランキング画像", 出力フォルダPath & "総合ランキング.png")
    Call Word画像差し替え(wdDoc, "評価項目画像", 出力フォルダPath & "評価項目別ランキング.png")
    
    ' ---------------------------------------
    ' 5. 保存
    ' ---------------------------------------
    Dim 出力ファイル名 As String
    出力ファイル名 = 出力フォルダPath & "プレスリリース_" & Format(Now, "yyyymmdd") & ".docx"
    
    wdDoc.SaveAs2 Filename:=出力ファイル名
    wdDoc.Close
    
    ' クリーンアップ
    wdApp.Quit
    Set wdDoc = Nothing
    Set wdApp = Nothing
    
    リリースwb.Close SaveChanges:=False
    Set リリースwb = Nothing
    
End Sub

' Word内の画像を差し替え
Sub Word画像差し替え(wdDoc As Object, プレースホルダー名 As String, 画像Path As String)
    
    ' ブックマーク or InlineShapeで画像を特定して差し替え
    Dim shp As Object
    
    On Error Resume Next
    ' 既存画像を削除
    wdDoc.Bookmarks(プレースホルダー名).Range.InlineShapes(1).Delete
    
    ' 新しい画像を挿入
    wdDoc.Bookmarks(プレースホルダー名).Range.InlineShapes.AddPicture _
        Filename:=画像Path, _
        LinkToFile:=False, _
        SaveWithDocument:=True
    On Error GoTo 0
    
End Sub

' 本文自動生成(ルールベース)
Function 本文自動生成(ws As Worksheet) As String
    
    Dim 本文 As String
    Dim 一位企業 As String
    Dim 一位得点 As Double
    
    一位企業 = ws.Cells(9, 3).Value
    一位得点 = ws.Cells(9, 4).Value
    
    本文 = "オリコン株式会社は、" & vbNewLine
    本文 = 本文 & "年1回の満足度調査「オリコン顧客満足度®調査」を実施し、" & vbNewLine
    本文 = 本文 & Format(Now, "yyyy年m月d日") & "に調査結果を公式サイト内にて発表しました。" & vbNewLine
    本文 = 本文 & vbNewLine
    本文 = 本文 & "【TOPICS】" & vbNewLine
    本文 = 本文 & "■【" & 一位企業 & "】が3年連続総合1位(得点:" & 一位得点 & "点)" & vbNewLine
    ' ... 他のTOPICSを追加
    
    本文自動生成 = 本文
    
End Function