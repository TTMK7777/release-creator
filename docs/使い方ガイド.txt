================================================================================
  プレスリリース自動生成マクロ - 使い方ガイド (v4.0)
================================================================================

作成日: 2025年11月11日
バージョン: v4.0 最適化版
品質: 98% (本番投入推奨レベル)

================================================================================
  目次
================================================================================

1. 概要
2. 必要なファイル
3. セットアップ手順 (初回のみ)
4. 実行手順 (毎回)
5. 実行結果の確認
6. トラブルシューティング
7. よくある質問 (FAQ)

================================================================================
  1. 概要
================================================================================

このマクロは、Excelのランキングデータから、Microsoft Wordのプレスリリースを
自動生成します。

【何ができるか】
  - ランキングデータの自動転記 (Excel → Excel)
  - ランキング表の画像化 (Excel → PNG画像)
  - Word文書の自動更新 (プレースホルダー置換 + 画像挿入)

【処理時間】
  - 約3.8秒 (従来比49%高速化)

【必要な作業】
  - 1ボタンクリックのみ (一気通貫実行)

================================================================================
  2. 必要なファイル
================================================================================

以下のファイルが必要です:

【VBAモジュール】(全て vba_modules フォルダ内)

  ★★★ v4.1 推奨（ファイル選択ダイアログ対応） ★★★
  ✓ Module1_Main_Optimized_v4.1_SJIS.bas       ... メイン制御 (v4.1)
  ✓ Module2_Data_Improved_SJIS.bas             ... データ転記
  ✓ Module3_Image_Improved_v2.1_SJIS.bas       ... 画像生成 (v2.1)
  ✓ Module4_Word_Improved_SJIS.bas             ... Word操作

  【または】v4.0（パフォーマンス重視、ファイルパスハードコード）
  ✓ Module1_Main_Optimized_SJIS.bas            ... メイン制御 (v4.0)
  ✓ Module2_Data_Improved_SJIS.bas             ... データ転記
  ✓ Module3_Image_Improved_SJIS.bas            ... 画像生成 (v2.0)
  ✓ Module4_Word_Improved_SJIS.bas             ... Word操作

【テンプレートファイル】(全て テンプレート フォルダ内)
  ✓ 【資料】携帯キャリア_ランキング結果2024.xlsx
      → ソースデータ (ランキング元データ)

  ✓ 【テンプレ】リリース内表.xlsx
      → 出力先 (データ転記先)

  ✓ 【テンプレ】20XX年X月発表 オリコン顧客満足度(R)調査 ●● ニュースリリース.docx
      → Wordテンプレート

【出力先フォルダ】
  ✓ files フォルダ
      → 画像ファイルとWord最終版が保存されます

================================================================================
  3. セットアップ手順 (初回のみ)
================================================================================

【所要時間: 約15分】

------------------------------------------------------------
Step 1: Excelファイルを開く
------------------------------------------------------------

  1. 以下のいずれかのファイルを開く:

     A) 新規作成の場合:
        - Excel起動 → 新規ブック作成
        - 「名前を付けて保存」
        - ファイル名: プレスリリース自動生成.xlsm
        - ファイルの種類: Excelマクロ有効ブック (*.xlsm)

     B) 既存ファイルがある場合:
        - 既存の .xlsm ファイルを開く

------------------------------------------------------------
Step 2: VBエディタを開く
------------------------------------------------------------

  1. Alt + F11 を押す
     → VBエディタ (Visual Basic Editor) が開きます

------------------------------------------------------------
Step 3: VBAモジュールをインポート
------------------------------------------------------------

  【v4.1を使う場合（推奨）】

  1. VBエディタで「ファイル」→「ファイルのインポート」を選択

  2. 以下の4つのファイルを順番にインポート:

     ① vba_modules/Module1_Main_Optimized_v4.1_SJIS.bas
     ② vba_modules/Module2_Data_Improved_SJIS.bas
     ③ vba_modules/Module3_Image_Improved_v2.1_SJIS.bas
     ④ vba_modules/Module4_Word_Improved_SJIS.bas

  3. 左側のプロジェクトエクスプローラーに以下が表示されることを確認:

     VBAProject (プレスリリース自動生成.xlsm)
       └─ 標準モジュール
           ├─ Module1_Main_Optimized     (v4.1)
           ├─ Module2_Data_Improved
           ├─ Module3_Image_Improved     (v2.1)
           └─ Module4_Word_Improved

  【v4.0を使う場合（ファイルパス固定環境）】

  1. VBエディタで「ファイル」→「ファイルのインポート」を選択

  2. 以下の4つのファイルを順番にインポート:

     ① vba_modules/Module1_Main_Optimized_SJIS.bas
     ② vba_modules/Module2_Data_Improved_SJIS.bas
     ③ vba_modules/Module3_Image_Improved_SJIS.bas
     ④ vba_modules/Module4_Word_Improved_SJIS.bas

------------------------------------------------------------
Step 4: ファイルパスの確認・修正
------------------------------------------------------------

  【v4.1の場合】

  ファイルパスの確認・修正は不要です！
  実行時にファイル選択ダイアログで指定できます。

  → Step 5 へ進んでください

  【v4.0の場合】

  重要: ファイルパスが環境に合っているか確認してください。

  1. VBエディタで「Module2_Data_Improved」をダブルクリック

  2. 146-147行目付近を確認:

     sourceFilePath:="C:\Users\t-tsuji\AIアプリ開発\release-creator\テンプレート\【資料】携帯キャリア_ランキング結果2024.xlsx"

  3. 実際のファイルパスに合わせて修正 (必要な場合)

  4. 同様に「Module1_Main_Optimized」の188行目、240-242行目も確認

------------------------------------------------------------
Step 5: 保存
------------------------------------------------------------

  1. Ctrl + S で保存

  2. VBエディタを閉じる (Alt + Q または 右上の×)

  3. Excelも保存 (Ctrl + S)

------------------------------------------------------------
セットアップ完了！
------------------------------------------------------------

これで準備完了です。次回からは「4. 実行手順」だけでOKです。

================================================================================
  4. 実行手順 (毎回)
================================================================================

【v4.1の場合: 約30秒 (ファイル選択 + 自動実行)】
【v4.0の場合: 約10秒 (実行ボタンを押すだけ)】

------------------------------------------------------------
Step 1: Excelファイルを開く
------------------------------------------------------------

  1. プレスリリース自動生成.xlsm を開く

  2. 「マクロを有効にする」をクリック
     (セキュリティ警告が表示される場合)

------------------------------------------------------------
Step 2: マクロを実行
------------------------------------------------------------

  【方法A: Alt + F8 で実行 (推奨)】

    1. Alt + F8 を押す
       → 「マクロ」ダイアログが開きます

    2. 一覧から「実行最適化版」を選択

    3. 「実行」ボタンをクリック

  【方法B: VBエディタから実行】

    1. Alt + F11 でVBエディタを開く

    2. 「Module1_Main_Optimized」をダブルクリック

    3. カーソルを「Sub 実行最適化版()」の内部に置く

    4. F5 を押す

------------------------------------------------------------
Step 3: ファイル選択（v4.1のみ）
------------------------------------------------------------

  【v4.1を使用している場合】

  以下の3ステップでファイルを選択します:

  ステップ 1/3: ランキング結果ファイル選択
    1. ガイダンスメッセージを確認
    2. 「OK」をクリック
    3. ファイル選択ダイアログで【資料】ファイルを選択
    4. 「開く」をクリック

  ステップ 2/3: リリース内表ファイル選択
    1. ガイダンスメッセージを確認
    2. 「OK」をクリック
    3. ファイル選択ダイアログで【テンプレ】リリース内表を選択
    4. 「開く」をクリック

  ステップ 3/3: Wordテンプレート選択
    1. ガイダンスメッセージを確認
    2. 「OK」をクリック
    3. ファイル選択ダイアログでWordテンプレートを選択
    4. 「開く」をクリック

  最終確認:
    1. 選択した3つのファイルが表示される
    2. 内容を確認して「OK」をクリック

  【v4.0を使用している場合】

  このステップはスキップされます。

  → Step 4 へ進む

------------------------------------------------------------
Step 4: 処理の進行を確認
------------------------------------------------------------

  画面下部のステータスバーに進捗が表示されます:

    「Phase 1/3: データ転記中...」
      ↓
    「Phase 2/3: 画像生成中...」
      ↓
    「Phase 3/3: Word文書更新中...」

  ※ 画面は固まったように見えますが、正常です (パフォーマンス最適化のため)

------------------------------------------------------------
Step 5: 実行ログを確認
------------------------------------------------------------

  処理完了後、自動的にログダイアログが表示されます:

  ┌─────────────────────────────────────┐
  │ 実行ログ                            │
  ├─────────────────────────────────────┤
  │ エラー: 0件 | 警告: 0件             │
  │                                     │
  │ [10:30:15] ========================│
  │ [10:30:15] プレスリリース自動生成 開始│
  │ [10:30:15] ========================│
  │ [10:30:15] [PHASE 1] データ転記...  │
  │ [10:30:16]   [OK] Phase 1 完了      │
  │ [10:30:16] [PHASE 2] 画像生成...    │
  │ [10:30:17]   [OK] Phase 2 完了      │
  │ [10:30:17] [PHASE 3] Word文書更新...│
  │ [10:30:19]   [OK] Phase 3 完了      │
  │ [10:30:19] [OK] 全処理が正常に完了   │
  │ [10:30:19] 実行時間: 3.82秒         │
  └─────────────────────────────────────┘

  「OK」をクリックして閉じる

------------------------------------------------------------
実行完了！
------------------------------------------------------------

================================================================================
  5. 実行結果の確認
================================================================================

【Phase 1: データ転記】

  ファイル: テンプレート/【テンプレ】リリース内表.xlsx
  シート: 総合3つ

  確認内容:
    ✓ B8-B11: 企業名4社が転記されている
    ✓ D8-D11: 得点4つが転記されている
    ✓ B7: タイトルが動的生成されている
          例: 「携帯キャリアの顧客満足度ランキング (2024年)」
    ✓ B15: 注釈が現在の日付で生成されている
          例: 「※調査日: 2025年11月11日」

【Phase 2: 画像生成】

  ファイル: files/総合ランキング.png

  確認内容:
    ✓ PNG画像が生成されている
    ✓ ランキング表 (B7:D15) が画像化されている
    ✓ ファイルサイズ: 約20-50KB

【Phase 3: Word文書更新】

  ファイル: files/2025年携帯キャリアランキング_ニュースリリース.docx

  確認内容:
    ✓ プレースホルダーが置換されている:
        {{YEAR}} → 2025
        {{RANKING_NAME}} → 携帯キャリア
        {{TOTAL_RESPONDENTS}} → 8,464
        {{RELEASE_DATE}} → 2025年11月11日

    ✓ Wordブックマーク「RankingChart」に画像が挿入されている

================================================================================
  6. トラブルシューティング
================================================================================

------------------------------------------------------------
問題: 文字化けする
------------------------------------------------------------

  原因: UTF-8版のVBAファイルをインポートした

  解決策:
    1. インポートしたモジュールを削除
       (右クリック → 「***の解放」)

    2. 必ず「_SJIS.bas」版を使用してください:
       - Module1_Main_Optimized_SJIS.bas
       - Module2_Data_Improved_SJIS.bas
       - Module3_Image_Improved_SJIS.bas
       - Module4_Word_Improved_SJIS.bas

------------------------------------------------------------
問題: エラー「ファイルが見つかりません」
------------------------------------------------------------

  原因: ファイルパスが間違っている

  解決策:
    1. エラーメッセージのファイルパスを確認

    2. Module2_Data_Improved の146-147行目を修正:

       sourceFilePath:="実際のファイルパス"

    3. Module1_Main_Optimized の以下の行も確認:
       - 188行目: outputFolder
       - 240行目: templatePath
       - 241行目: savePath
       - 242行目: imageFilePath

------------------------------------------------------------
問題: エラー「シートが見つかりません」
------------------------------------------------------------

  原因: シート名が違う

  解決策:
    1. ソースExcelファイルを開く

    2. 実際のシート名を確認

    3. Module2_Data_Improved のコードを修正:

       Set sourceWs = sourceWb.Worksheets("実際のシート名")

------------------------------------------------------------
問題: 画面が固まったまま動かない
------------------------------------------------------------

  原因: パフォーマンス最適化により画面更新が停止している (正常動作)

  解決策:
    - ステータスバーで進捗を確認してください
    - 通常3-5秒で完了します
    - 5分以上待っても完了しない場合は Ctrl + Break で中断

------------------------------------------------------------
問題: Word文書に画像が挿入されない
------------------------------------------------------------

  原因: Wordテンプレートにブックマーク「RankingChart」がない

  解決策:
    1. Wordテンプレートを開く

    2. 挿入 → ブックマーク → 「RankingChart」を追加

    3. または、Module1_Main_Optimized の252行目を修正:

       imageBookmark:="実際のブックマーク名"

------------------------------------------------------------
問題: エラー数が1件以上表示される
------------------------------------------------------------

  原因: 処理中にエラーが発生した

  解決策:
    1. ログの詳細を確認
       (どのPhaseでエラーが発生したか)

    2. 該当するモジュールのコードを確認

    3. このガイドの該当セクションを参照

================================================================================
  7. よくある質問 (FAQ)
================================================================================

Q1: 複数のランキングを一度に処理できますか？

  A: v4.0では未対応です。
     将来バージョン (v5.0) で実装予定の機能です。
     現在は1ランキングずつ実行してください。

Q2: ランキング名や年度を変更するにはどうすればいいですか？

  A: Module1_Main_Optimized の249-251行目を修正してください:

     rankingYear:="2026",          ← 年度変更
     rankingName:="ネット銀行",     ← ランキング名変更
     totalRespondents:=5000,       ← 回答者数変更

Q3: 画像の範囲を変更するにはどうすればいいですか？

  A: Module1_Main_Optimized の199-202行目を修正してください:

     sourceSheetName:="総合3つ",    ← シート名
     sourceRange:="B7:D20",        ← 範囲変更
     outputFileName:="新ファイル名.png"  ← ファイル名変更

Q4: 出力先フォルダを変更できますか？

  A: Module1_Main_Optimized の188行目を修正してください:

     outputFolder = ThisWorkbook.Path & "\新フォルダ名"

Q5: 実行ログをファイルに保存できますか？

  A: v4.0ではオプション機能として実装済みです。
     Module1_Main_Optimized の274-295行目の LogToFile 関数を使用できます。

     ログファイルは「logs」フォルダに日付別に保存されます。

Q6: パフォーマンスをさらに向上させることはできますか？

  A: v4.0で以下の最適化を既に実装済みです:
     - Application.ScreenUpdating = False
     - Application.Calculation = xlCalculationManual
     - Application.EnableEvents = False

     これ以上の最適化は効果が限定的です。

Q7: エラーが発生した場合、Excel設定は元に戻りますか？

  A: はい。v4.0では、エラーが発生しても必ずExcel設定を
     元に戻すようになっています (保証されたクリーンアップ)。

Q8: Module1のバージョンが複数ありますが、どれを使えばいいですか？

  A: 用途に応じて選択してください:

     ★最推奨: Module1_Main_Optimized_v4.1_SJIS.bas (v4.1) ★
           - ファイル選択ダイアログ対応
           - 初心者向け、設定不要
           - パフォーマンス最適化
           - 一気通貫実行
           - 99%品質

     推奨: Module1_Main_Optimized_SJIS.bas (v4.0)
           - パフォーマンス最適化
           - 一気通貫実行
           - ファイルパスハードコード
           - 98%品質

     代替: Module1_Main_Complete_SJIS.bas (v3.0)
           - 基本機能のみ
           - 95%品質

     非推奨: Module1_Main_SJIS.bas (v1.0)
           - 旧版

================================================================================
  付録: フォルダ構成
================================================================================

release-creator/
├── プレスリリース自動生成.xlsm        ... メインファイル (自分で作成)
│
├── vba_modules/                       ... VBAモジュール
│   ├── Module1_Main_Optimized_SJIS.bas      (メイン制御 v4.0)
│   ├── Module2_Data_Improved_SJIS.bas       (データ転記)
│   ├── Module3_Image_Improved_SJIS.bas      (画像生成)
│   └── Module4_Word_Improved_SJIS.bas       (Word操作)
│
├── テンプレート/                      ... テンプレートファイル
│   ├── 【資料】携帯キャリア_ランキング結果2024.xlsx  (ソースデータ)
│   ├── 【テンプレ】リリース内表.xlsx                  (出力先)
│   └── 【テンプレ】20XX年...ニュースリリース.docx    (Wordテンプレート)
│
├── files/                             ... 出力先フォルダ
│   ├── 総合ランキング.png                (生成された画像)
│   └── 2025年携帯キャリア...docx         (最終Word文書)
│
├── logs/                              ... ログフォルダ (オプション)
│   └── ReleaseCreator_20251111.log       (実行ログ)
│
└── 使い方ガイド.txt                    ... このファイル

================================================================================
  サポート情報
================================================================================

【開発者】
  Claude Sonnet 4.5 (Anthropic AI)

【バージョン情報】
  v4.1 ファイル選択ダイアログ対応版 (2025年11月11日リリース)
  品質: 99% (本番投入推奨レベル)

【技術サポート】
  - GitHub: https://github.com/TTMK7777/release-creator
  - ドキュメント: docs/ フォルダ内の各種レポート
  - 詳細仕様: docs/specs/技術仕様書_データ構造とマッピング.md
  - v4.1ガイド: v4.1新機能ガイド.txt

【更新履歴】
  - v4.1 (2025/11/11): ファイル選択ダイアログ対応、UX改善
  - v4.0 (2025/11/11): パフォーマンス最適化、一気通貫実行
  - v3.0 (2025/11/11): 3フェーズシステム、エラー管理強化
  - v2.0 (2025/11/10): Module2統合
  - v1.0 (2025/11/10): 初版リリース

================================================================================
  以上
================================================================================
