# プレスリリース自動生成マクロ - セットアップ手順

**作成日**: 2025年11月10日
**目的**: 今までの作業内容を実際に動かす

---

## 📋 目次

1. [準備するもの](#1-準備するもの)
2. [Excelファイルの作成](#2-excelファイルの作成)
3. [VBAモジュールのインポート](#3-vbaモジュールのインポート)
4. [動作確認](#4-動作確認)
5. [トラブルシューティング](#5-トラブルシューティング)

---

## 1. 準備するもの

### 必要なファイル

- ✅ テンプレートフォルダのファイル (既にあります):
  ```
  C:\Users\t-tsuji\AIアプリ開発\release-creator\テンプレート\
  ├── 【資料】携帯キャリア_ランキング結果2024.xlsx
  ├── 【テンプレ】リリース内表.xlsx
  └── 【テンプレ】20XX年X月発表...ニュースリリース.docx
  ```

- ✅ VBAモジュールファイル (既にあります):
  ```
  C:\Users\t-tsuji\AIアプリ開発\release-creator\vba_modules\
  └── Module2_Data_Improved.bas
  ```

### 必要な環境

- Windows 10/11
- Microsoft Excel 2016以降
- Microsoft Word 2016以降

---

## 2. Excelファイルの作成

### Step 1: 新しいExcelファイルを作成

1. Excelを起動
2. 「新しいブック」を作成
3. 名前を付けて保存:
   ```
   ファイル名: プレスリリース自動生成_Test.xlsm
   保存場所: C:\Users\t-tsuji\AIアプリ開発\release-creator\
   ファイルの種類: Excelマクロ有効ブック (*.xlsm)
   ```

### Step 2: 開発タブを表示 (初回のみ)

1. 「ファイル」→「オプション」
2. 「リボンのユーザー設定」
3. 右側の「開発」にチェック ✅
4. OK

---

## 3. VBAモジュールのインポート

### Step 3: VBEを開く

1. `Alt + F11` を押す (Visual Basic Editorが開く)

### Step 4: Module2_Dataをインポート

1. VBEで「ファイル」→「ファイルのインポート」
2. 以下のファイルを選択:
   ```
   C:\Users\t-tsuji\AIアプリ開発\release-creator\vba_modules\Module2_Data_Improved.bas
   ```
3. 「開く」をクリック

### Step 5: Module1_Main (簡易版) を作成

VBEで「挿入」→「標準モジュール」→ 以下のコードを貼り付け:

```vba
Attribute VB_Name = "Module1_Main"
Option Explicit

' グローバルログ変数
Private g_ExecutionLog As String

'========================================
' ログ記録関数 (簡易版)
'========================================
Public Sub LogMessage(msg As String)
    Dim timestamp As String
    timestamp = Format(Now, "hh:nn:ss")

    g_ExecutionLog = g_ExecutionLog & "[" & timestamp & "] " & msg & vbCrLf
    Debug.Print "[" & timestamp & "] " & msg
End Sub

'========================================
' ログ表示
'========================================
Public Sub ShowLog()
    MsgBox g_ExecutionLog, vbInformation, "実行ログ"
End Sub

'========================================
' メイン実行 (簡易版)
'========================================
Public Sub 実行()
    Dim startTime As Double
    startTime = Timer

    g_ExecutionLog = ""

    LogMessage "========================================="
    LogMessage "プレスリリース自動生成 開始"
    LogMessage "========================================="

    ' データ転記を実行
    Dim result As Boolean
    result = Module2_Data.TransferRankingDataSimple()

    If result Then
        LogMessage "✓ 処理が正常に完了しました"
    Else
        LogMessage "✗ 処理中にエラーが発生しました"
    End If

    Dim endTime As Double
    endTime = Timer

    LogMessage "実行時間: " & Format((endTime - startTime), "0.00") & "秒"
    LogMessage "========================================="

    ' ログを表示
    ShowLog
End Sub
```

### Step 6: 保存

1. `Ctrl + S` で保存
2. VBEを閉じる (`Alt + Q`)

---

## 4. 動作確認

### Step 7: マクロを実行

**方法1: ボタンから実行 (推奨)**

1. Excelの「開発」タブ → 「挿入」→ 「ボタン (フォームコントロール)」
2. シート上に適当な大きさでボタンを描画
3. 「マクロの登録」ダイアログで `Module1_Main.実行` を選択
4. ボタンのテキストを「プレスリリース自動生成」に変更
5. ボタンをクリック

**方法2: VBEから実行**

1. `Alt + F11` でVBEを開く
2. `Module1_Main` を開く
3. `実行` 関数の中にカーソルを置く
4. `F5` を押す

### Step 8: 結果確認

**成功した場合**:

メッセージボックスが表示され、以下のようなログが表示されます:

```
[18:30:00] =========================================
[18:30:00] プレスリリース自動生成 開始
[18:30:00] =========================================
[18:30:00] データ転記を開始します...
[18:30:00]   元データ: C:\Users\...\ランキング結果2024.xlsx
[18:30:01]   出力先: C:\Users\...\リリース内表.xlsx
[18:30:01]   ランキング企業数: 4社
[18:30:02]   ✓ ランキングデータ転記完了 (4件)
[18:30:02]   ✓ タイトル生成完了
[18:30:02]   ✓ 注釈生成完了
[18:30:03] データ転記が正常に完了しました
[18:30:03] ✓ 処理が正常に完了しました
[18:30:03] 実行時間: 3.25秒
[18:30:03] =========================================
```

**確認すべきこと**:

1. テンプレートフォルダの「【テンプレ】リリース内表.xlsx」を開く
2. 以下が更新されているか確認:
   - C11-C14: 企業名4社
   - D11-D14: 得点4つ
   - C7:D9: タイトル ("2025年 オリコン顧客満足度®調査...")
   - B15:D15: 注釈

---

## 5. トラブルシューティング

### エラー: "ファイルが見つかりません"

**原因**: ファイルパスが間違っている

**対処**:

1. VBEで `Module2_Data` を開く
2. `TransferRankingDataSimple` 関数の中のパスを確認:
   ```vba
   sourceFilePath:="C:\Users\t-tsuji\AIアプリ開発\release-creator\テンプレート\【資料】携帯キャリア_ランキング結果2024.xlsx"
   ```
3. 実際のファイルパスと一致しているか確認
4. 必要に応じて修正

### エラー: "シートが見つかりません"

**原因**: シート名が違う

**対処**:

1. 実際のExcelファイルを開いてシート名を確認
2. VBEで `Module2_Data` の `TransferRankingData` 関数を開く
3. シート名を修正:
   ```vba
   Set sourceWs = sourceWb.Worksheets("総合対象企業")  ' ← 実際のシート名
   Set targetWs = targetWb.Worksheets("総合3つ")      ' ← 実際のシート名
   ```

### エラー: "実行時エラー '1004'"

**原因**: セル範囲が間違っている

**対処**:

1. 実際のExcelファイルを開いて、データの位置を確認
2. VBEで `Module2_Data` の以下の行を確認:
   ```vba
   sourceRow = 5  ' 元データの開始行
   targetRow = 11 ' リリース表の開始行
   ```
3. 必要に応じて修正

---

## 6. 次のステップ

動作確認ができたら:

1. ✅ Module3_Image (画像生成) の実装
2. ✅ Module4_Word (Word操作) の実装
3. ✅ GUI (UserForm) の追加

---

## 📝 メモ

### 現在の実装状況

- ✅ Module1_Main: 簡易版実装済み
- ✅ Module2_Data_Improved: 完全実装済み (動的対応)
- ✅ Module3_Image: 基本実装済み (GPT-4o) ※ハードコード値あり
- ✅ Module4_Word: 基本実装済み (GPT-4o) ※ハードコード値あり
- ⚠️ Module5_Utils: 未実装 (次回)

**利用可能なファイル**:
- `Module1_Main_SJIS.bas` - メイン制御モジュール
- `Module2_Data_Improved_SJIS.bas` - データ転記（完全版）
- `Module3_Image_SJIS.bas` - 画像生成（基本版）
- `Module4_Word_SJIS.bas` - Word操作（基本版）

※全て `_SJIS.bas` 版を使用してください（文字化け防止）

### パラメータのカスタマイズ方法

デフォルト値を変更したい場合は、`Module2_Data` の `TransferRankingDataSimple` 関数を編集:

```vba
Public Function TransferRankingDataSimple() As Boolean
    TransferRankingDataSimple = TransferRankingData( _
        sourceFilePath:="...", _     ' ← ここを変更
        targetFilePath:="...", _     ' ← ここを変更
        rankingYear:="2025", _       ' ← 年度
        rankingName:="携帯キャリア", _ ' ← ランキング名
        totalRespondents:=8464, _    ' ← 回答者数
        rankingCount:=4 _            ' ← 企業数
    )
End Function
```

---

**作成者**: Claude Sonnet 4.5
**作成日時**: 2025年11月10日 19:00
**ステータス**: テスト準備完了
